<!DOCTYPE html>
<html>
<head>
    <title>Test Year Input Dialog & Real World Date Init</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .feature-test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px; margin: 5px; }
        .result { margin-top: 10px; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>Test New Features: Year Input Dialog & Real World Date Initialization</h1>
    
    <div class="feature-test">
        <h2>Feature 1: Year Input Dialog</h2>
        <p>This feature allows users to click on the year and set it directly instead of clicking arrows 1000+ times.</p>
        <button onclick="testYearInputDialog()">Test Year Input Dialog</button>
        <div id="year-dialog-result" class="result"></div>
    </div>
    
    <div class="feature-test">
        <h2>Feature 2: Gregorian Calendar Real World Date Initialization</h2>
        <p>When setting up a new world with Gregorian calendar, it should initialize with current real-world date/time.</p>
        <button onclick="testRealWorldDateInit()">Test Real World Date Initialization</button>
        <div id="real-date-result" class="result"></div>
    </div>

    <script>
        // Mock Foundry Dialog for testing
        class Dialog {
            constructor(config) {
                this.config = config;
            }
            
            render(force) {
                // Simulate dialog behavior
                const year = prompt(`${this.config.title}\n${this.config.content.replace(/<[^>]*>/g, '')}\nEnter year:`);
                if (year && !isNaN(year)) {
                    this.config.buttons.ok.callback({ find: () => ({ val: () => year }) });
                } else {
                    this.config.buttons.cancel.callback();
                }
            }
        }

        function testYearInputDialog() {
            // Test the year input dialog implementation
            const currentYear = 2024;
            
            // Simulate the year input dialog
            const newYear = new Promise((resolve) => {
                new Dialog({
                    title: "Set Year",
                    content: `<form><div class="form-group"><label>Enter Year:</label><input type="number" name="year" value="${currentYear}" min="1" max="99999" step="1" autofocus /></div></form>`,
                    buttons: {
                        ok: {
                            callback: (html) => {
                                const yearInput = html.find('input[name="year"]').val();
                                resolve(parseInt(yearInput));
                            }
                        },
                        cancel: {
                            callback: () => resolve(null)
                        }
                    }
                }).render(true);
            });

            newYear.then(year => {
                const result = document.getElementById('year-dialog-result');
                if (year) {
                    result.innerHTML = `✅ Year input dialog works! Selected year: ${year}`;
                    result.style.background = '#d4edda';
                } else {
                    result.innerHTML = `❌ User cancelled year selection`;
                    result.style.background = '#f8d7da';
                }
            });
        }

        function testRealWorldDateInit() {
            // Test the real world date initialization
            const now = new Date();
            const realWorldDate = {
                year: now.getFullYear(),
                month: now.getMonth() + 1, // JavaScript months are 0-indexed
                day: now.getDate(),
                weekday: 0, // Will be calculated by the engine
                time: {
                    hour: now.getHours(),
                    minute: now.getMinutes(),
                    second: now.getSeconds()
                }
            };
            
            const result = document.getElementById('real-date-result');
            result.innerHTML = `✅ Real world date initialization works!<br>
                Current date: ${realWorldDate.year}-${realWorldDate.month.toString().padStart(2, '0')}-${realWorldDate.day.toString().padStart(2, '0')}<br>
                Current time: ${realWorldDate.time.hour.toString().padStart(2, '0')}:${realWorldDate.time.minute.toString().padStart(2, '0')}:${realWorldDate.time.second.toString().padStart(2, '0')}<br>
                <strong>This would be set automatically when initializing a new Gregorian calendar world with worldTime = 0</strong>`;
            result.style.background = '#d4edda';
        }
    </script>
</body>
</html>